
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>To [Decorate] or not to [Decorate] - Tomasz Pluskiewicz</title>
	<meta name="author" content="Tomasz Pluskiewicz">

	
	<meta name="description" content="When I use attributes and when I don't and why I don't exactly like my current solution">
    
        <meta name="keywords" content="dajsiepoznac, argolis, c# attributes">
    

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="http://t-code.pl/atom.xml" rel="alternate" title="Tomasz Pluskiewicz" type="application/atom+xml">
	
	<link rel="canonical" href="http://t-code.pl/blog/2016/03/to-attribute-or-not-to-attribute/">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/stylesheets/resume.css" media="all" />
<link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-24217426-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/1497654c2d1af3cef4987234d1aced57?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<hgroup>
  <h1><a href="/">Tomasz Pluskiewicz</a></h1>
  
  <h2>Awaiting the Semantic Web</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main">
    <li><a href="/me">About</a></li>
    <li><a href="/resume">Resume</a></li>
    <li><a href="/">Blog</a></li>
    <li><a href="/talks">Presentations</a></li>
    <li><a href="/projects">Projects</a></li>
    <li><a href="/links">Links</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>


</nav>
<nav id="flairs">
    <a href="http://www.w3.org/RDF/" title="RDF Resource Description Framework" target='_blank'> 
        <img border="0" src="http://www.w3.org/RDF/icons/rdf_developer_button.48" alt="RDF Resource Description Framework Developer Icon"/>
    </a>

    <a href="http://stackoverflow.com/users/1103498/tomasz-pluskiewicz" target='_blank'>
        <img src="http://stackoverflow.com/users/flair/1103498.png?theme=clean" width="208" height="58" alt="profile for Tomasz Pluskiewicz at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for Tomasz Pluskiewicz at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
    </a>

    <a href='https://www.openhub.net/accounts/132022?ref=Detailed' target='_blank'>
        <img alt='Open Hub profile for Tomasz Pluskiewicz' border='0' height='35' src='https://www.openhub.net/accounts/132022/widgets/account_detailed.gif' width='230' />
    </a>
</nav>

<nav id="smallFlairs">
    <a href='https://www.openhub.net/accounts/132022?ref=Tiny' target='_blank'>
        <img alt='Open Hub profile for Tomasz Pluskiewicz' border='0' height='15' src='https://www.openhub.net/accounts/132022/widgets/account_tiny.gif' width='80' />
    </a>
</nav>

<nav id="sub-nav">
	<div class="social">
		
		
		
		
			<a class="twitter" href="http://twitter.com/tpluscode" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/tpluscode" title="GitHub">GitHub</a>
		
		
        
            <a class="stackoverflow" href="http://stackoverflow.com/users/1103498/tomasz-pluskiewicz" title="StackOverflow"></a>
        
        
            <a class="semanticweb" href="http://answers.semanticweb.com/users/1788/tomasz-pluskiewicz" title="SemanticWeb answers"></a>
        
        <a class="ohloh" href="https://www.openhub.net/accounts/132022?ref=Rank" title="Ohloh rank"></a>
		
			<a class="linkedin" href="http://www.linkedin.com/in/tpluskiewicz" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">To [Decorate] or Not to [Decorate]</h1>
	<div class="entry-content" itemprop="articleBody"><p>Attributes are a very useful feature of many languages but I personally feel that they are used too often and in wrong
circumstances. They’re primary shortcoming is the fact that attributes are set up at compile time. During code execution
they can only be read but not modified.</p>

<!--more-->

<h2 id="how-i-use-attributes">How I use attributes</h2>

<p>In <a href="http://github.com/wikibus/argolis">Argolis</a> I created a number of attributes to decorate classes which I want to expose in my <a href="http://hydra-cg.com">Hydra</a> API.
I also reuse some attributes from Newtonsoft.Json and core libraries.</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="c#"><span class="line"><span class="na">[SupportedClass(&quot;http://example.api/vocab#Issue&quot;)]</span>
</span><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">Issue</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="na">    [Range(&quot;http://purl.org/dc/terms/title&quot;)]</span>
</span><span class="line"><span class="na">    [Description(&quot;Short description of the problem&quot;)]</span>
</span><span class="line">    <span class="k">public</span> <span class="kt">string</span> <span class="n">Title</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line"><span class="na">    </span>
</span><span class="line"><span class="na">    [ReadOnly(true)]</span>
</span><span class="line"><span class="na">    [JsonProperty(&quot;date&quot;)]</span>
</span><span class="line">    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">DateCreated</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>This is used to produce a machine-readable description of a <strong>supported class</strong> on the server, which ensures that the 
client is always using the latest API.</p>

<h2 id="when-i-dont-use-attributes">When I don’t use attributes</h2>

<p>The above usage seems legit. After all this information is static: the identifiers don’t change at runtime, neither does
the general contract.</p>

<p><img src="/uploads/2016/03/puzzle.jpg" alt="puzzle" /></p>

<p>The next piece of my API Documentation puzzle are operations on a resource. In the simplest form they can define whether
given a resource <code>/users/tpluscode</code> it is possible to perform <code>PUT</code> or <code>POST</code> etc.</p>

<p>However, unlike the contract, resource’s behaviour is likely to change depending on its state <em>(eg. it shouldn’t be possible
to delete an Issue in progress)</em> or the current authorized user <em>(eg. only administrators and owners should be allowed to
delete an issue)</em>. With this requirement in mind I decided that attributes are not a good choice, because I would have to
somehow bind them with contextual behaviour. That behaviour would live in another type, be passed to the attribute instance
and somehow have to be combined at runtime. (Forgive the hideous class name <img class="emoji" title=":wink:" alt=":wink:" src="https://assets.github.com/images/icons/emoji/unicode/1f609.png" height="20" width="20" align="absmiddle" />)</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="c#"><span class="line"><span class="na">[SupportsDeleteOperation(typeof(OnlyIfUserIsAdminOrOwner))]</span>
</span><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">Issue</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>I don’t like the code above, because it pollutes the static nature of attributes. I fear this solution would also lead to
coupling with a higher layer framework - Nancy in my case. Instead I created a basic interface, which is used to gather
information about the available operations and can work nicely with dependency injection inside Nancy or Web API. In
addition I prepared a simple base class, where operation can be wired up and some per-request context injected by the DI
container.</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="c#"><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">IssueSupportedOperations</span> <span class="p">:</span> <span class="n">SupportedOperations</span><span class="p">&lt;</span><span class="n">Issue</span><span class="p">&gt;,</span> <span class="n">ISupportedOperations</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">public</span> <span class="nf">IssueSupportedOperations</span><span class="p">(</span><span class="n">NancyContextWrapper</span> <span class="n">current</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="n">Class</span><span class="p">.</span><span class="n">SupportsGet</span><span class="p">();</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">CurrentUser</span><span class="p">.</span><span class="n">HasClaim</span><span class="p">(</span><span class="s">&quot;Admin&quot;</span><span class="p">))</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="n">Class</span><span class="p">.</span><span class="n">SupportsDelete</span><span class="p">();</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="n">Property</span><span class="p">(</span><span class="n">issue</span> <span class="p">=&gt;</span> <span class="n">issue</span><span class="p">.</span><span class="n">ProjectId</span><span class="p">).</span><span class="n">SupportsGet</span><span class="p">();</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<h2 id="to-decorate-or-not-to-decorate">To <code>[Decorate]</code> or not to <code>[Decorate]</code></h2>

<p><img src="/uploads/2016/03/roads-split.jpg" alt="puzzle" /></p>

<p>I must say I feel quite dirty nonetheless, because by mixing to solution to complementary features of my library I caused
some sort of duality - part of the API is to use attributes and part is to implement a base class, which the infrastructure
discovers at runtime.</p>

<p>I’m on edge here. It’s like mixing <a href="http://nhibernate.info/doc/nhibernate-reference/mapping-attributes.html">NHibernate attributes</a>
and <a href="https://github.com/jagregory/fluent-nhibernate">Fluent mappings</a> in the same project. I’d like to hear if people do
also find it a smell or is it acceptable.</p>

</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2021

    Tomasz Pluskiewicz


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'tcode';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://t-code.pl/blog/2016/03/to-attribute-or-not-to-attribute/';
        var disqus_url = 'http://t-code.pl/blog/2016/03/to-attribute-or-not-to-attribute/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
